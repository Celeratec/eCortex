# Gitleaks configuration for MeshCentral
# https://github.com/gitleaks/gitleaks

title = "MeshCentral Gitleaks Config"

# Global allowlist - files/paths to skip entirely
[allowlist]
  description = "Global allowlist"
  paths = [
    '''\.gitleaks\.toml''',
    '''\.pre-commit-config\.yaml''',
    '''\.secrets\.baseline''',
    '''node_modules''',
    '''package-lock\.json''',
    '''\.github/workflows/security-scan\.yml''',
  ]

# Rules for detecting secrets

# AWS Keys
[[rules]]
  id = "aws-access-key-id"
  description = "AWS Access Key ID"
  regex = '''AKIA[0-9A-Z]{16}'''
  tags = ["aws", "credentials"]

[[rules]]
  id = "aws-secret-access-key"
  description = "AWS Secret Access Key"
  regex = '''(?i)aws_secret_access_key\s*[=:]\s*[A-Za-z0-9/+=]{40}'''
  tags = ["aws", "credentials"]

# MongoDB Connection Strings
[[rules]]
  id = "mongodb-connection-string"
  description = "MongoDB connection string with credentials"
  regex = '''mongodb(\+srv)?://[^:]+:[^@]+@[^/]+'''
  tags = ["database", "mongodb"]

  [rules.allowlist]
    regexes = [
      '''PLACEHOLDER''',
      '''mongodb://MONGO_APP_USER''',
      '''mongodb://[^:]+:MONGO_APP_PASSWORD''',
    ]

# Generic API Keys
[[rules]]
  id = "generic-api-key"
  description = "Generic API Key"
  regex = '''(?i)(api[_-]?key|apikey)\s*[=:]\s*['""]?[A-Za-z0-9_\-]{20,}['""]?'''
  tags = ["api", "key"]

  [rules.allowlist]
    regexes = [
      '''PLACEHOLDER''',
      '''example''',
    ]

# Session Keys
[[rules]]
  id = "session-key"
  description = "Session Key"
  regex = '''(?i)session[_-]?key\s*[=:]\s*['""]?[A-Za-z0-9_\-]{20,}['""]?'''
  tags = ["session", "key"]

  [rules.allowlist]
    regexes = [
      '''PLACEHOLDER''',
      '''MyReallySecretPassword''',
    ]

# MeshCentral Invite Tokens
[[rules]]
  id = "meshcentral-invite"
  description = "MeshCentral invite/installation token"
  regex = '''meshinstall=[A-Za-z0-9]{10,}'''
  tags = ["meshcentral", "token"]

  [rules.allowlist]
    regexes = [
      '''PLACEHOLDER''',
      '''example''',
    ]

# Private Keys
[[rules]]
  id = "private-key"
  description = "Private Key"
  regex = '''-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'''
  tags = ["key", "private"]

# Password in config
[[rules]]
  id = "password-in-config"
  description = "Password in configuration"
  regex = '''(?i)(password|passwd|pwd)\s*[=:]\s*['""]?[^'""\s]{8,}['""]?'''
  tags = ["password"]

  [rules.allowlist]
    regexes = [
      '''PLACEHOLDER''',
      '''CHANGE_ME''',
      '''MyReallySecretPassword''',
      '''Password\.1''',
      '''amtpassword''',
      '''MyP@ssw0rd''',
      '''password1''',
      '''password2''',
    ]

# Generic Secret
[[rules]]
  id = "generic-secret"
  description = "Generic Secret"
  regex = '''(?i)(secret|token)\s*[=:]\s*['""]?[A-Za-z0-9_\-]{20,}['""]?'''
  tags = ["secret"]

  [rules.allowlist]
    regexes = [
      '''PLACEHOLDER''',
      '''example''',
      '''xxxxxxx''',
      '''xxxxx''',
    ]

# High Entropy Strings (potential secrets)
[[rules]]
  id = "high-entropy"
  description = "High entropy string (potential secret)"
  regex = '''[A-Za-z0-9+/]{40,}={0,2}'''
  entropy = 4.5
  tags = ["entropy"]

  [rules.allowlist]
    paths = [
      '''agents/''',
      '''\.min\.js$''',
      '''\.min\.css$''',
    ]
    regexes = [
      '''PLACEHOLDER''',
    ]
